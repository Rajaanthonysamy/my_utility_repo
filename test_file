from rdflib import Graph, Namespace, RDF, RDFS, OWL, SKOS
from rdflib.namespace import DCTERMS, XSD
import json

# Load your ontology
g = Graph()
g.parse("medusa.ttl", format="turtle")

# Namespaces
MEDUSA = Namespace("http://example.org/medusa#")
OPS = Namespace("http://example.org/ops#")
SH = Namespace("http://www.w3.org/ns/shacl#")

all_chunks = []

# -------------------------------
# ðŸ”¹ 1. Extract CLASSES
# -------------------------------
for cls in g.subjects(RDF.type, OWL.Class):
    label = g.value(cls, RDFS.label)
    definition = g.value(cls, SKOS.definition)
    subclass = g.value(cls, RDFS.subClassOf)

    text = f"Class: {cls.split('#')[-1]}\n"
    if label: text += f"Label: {label}\n"
    if definition: text += f"Definition: {definition}\n"
    if subclass: text += f"SubclassOf: {subclass.split('#')[-1]}\n"

    # Alt labels (skos:altLabel)
    for alt in g.objects(cls, SKOS.altLabel):
        text += f"AltLabel: {alt}\n"

    all_chunks.append(text.strip())


# -------------------------------
# ðŸ”¹ 2. Extract OBJECT PROPERTIES
# -------------------------------
for prop in g.subjects(RDF.type, OWL.ObjectProperty):
    label = g.value(prop, RDFS.label)
    definition = g.value(prop, SKOS.definition)
    domain = g.value(prop, RDFS.domain)
    range_ = g.value(prop, RDFS.range)

    text = f"ObjectProperty: {prop.split('#')[-1]}\n"
    if label: text += f"Label: {label}\n"
    if definition: text += f"Definition: {definition}\n"
    if domain: text += f"Domain: {domain.split('#')[-1]}\n"
    if range_: text += f"Range: {range_.split('#')[-1]}\n"

    all_chunks.append(text.strip())


# -------------------------------
# ðŸ”¹ 3. Extract DATA PROPERTIES
# -------------------------------
for prop in g.subjects(RDF.type, OWL.DatatypeProperty):
    label = g.value(prop, RDFS.label)
    definition = g.value(prop, SKOS.definition)
    domain = g.value(prop, RDFS.domain)
    datatype = g.value(prop, RDFS.range)

    text = f"DataProperty: {prop.split('#')[-1]}\n"
    if label: text += f"Label: {label}\n"
    if definition: text += f"Definition: {definition}\n"
    if domain: text += f"Domain: {domain.split('#')[-1]}\n"
    if datatype: text += f"Datatype: {datatype}\n"

    all_chunks.append(text.strip())


# -------------------------------
# ðŸ”¹ 4. Extract SHACL PROPERTY SHAPES
# -------------------------------
for shape in g.subjects(RDF.type, SH.PropertyShape):
    path = g.value(shape, SH.path)
    datatype = g.value(shape, SH.datatype)

    text = "SHACL PropertyShape:\n"
    if path:
        text += f"Path: {path.split('#')[-1]}\n"

    if datatype:
        text += f"Datatype: {datatype}\n"

    # sh:class (object-type constraints)
    for cls in g.objects(shape, SH["class"]):
        text += f"ClassConstraint: {cls.split('#')[-1]}\n"

    # sh:or case (list of constraints)
    for or_list in g.objects(shape, SH["or"]):
        for item in g.items(or_list):
            cls = g.value(item, SH["class"])
            if cls:
                text += f"OrClassConstraint: {cls.split('#')[-1]}\n"

    all_chunks.append(text.strip())


# -------------------------------
# ðŸ”¹ Print Summary
# -------------------------------
print("\nTOTAL CHUNKS:", len(all_chunks))
for c in all_chunks[:3]:
    print("\n--- SAMPLE ---\n", c)
