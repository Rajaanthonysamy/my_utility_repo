from rdflib.collection import Collection

def extract_shacl_properties(g, node):
    props = []

    for shprop in g.objects(node, SH.property):
        prop_info = {}

        # Get all predicate â†’ object
        for pred, obj in g.predicate_objects(shprop):

            pred_name = pred.split("#")[-1]

            # -----------------------------
            # Case 1: Normal properties
            # -----------------------------
            if pred != SH.or_:
                prop_info[pred_name] = str(obj)

            # -----------------------------
            # Case 2: sh:or (RDF list)
            # -----------------------------
            if pred == SH.or_:
                or_shapes = []
                collection = Collection(g, obj)

                for item in collection:
                    shape_details = {}
                    for p2, o2 in g.predicate_objects(item):
                        p2name = p2.split("#")[-1]
                        shape_details[p2name] = str(o2)

                    or_shapes.append(shape_details)

                prop_info["or"] = or_shapes

        props.append(prop_info)

    return props
